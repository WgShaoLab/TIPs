# tips-pipeline config (with TE search via blastp-short)


sample:
  # Path to the working directory for ONE biological sample.
  # Assumed subdirs:
  #   {sample_path}/mgf  (for de novo tools, *.mgf)
  #   {sample_path}/mzML (for DB search, *.mzML)
  path: "/path/to/sample_dir"

  # Name of the sample (used for logging / outputs)
  name: "Sample_XYZ"

gpu:
  # Which GPU ID to expose to de novo tools (CUDA_VISIBLE_DEVICES)
  id: "0"

denovo:
  # Minimum per-AA score to consider amino acid confident
  min_score: 0.75
  # Minimum peptide/tag length to keep
  min_length: 8

  # Paths to models/binaries of de novo engines
  casanovo:
    enable: true
    binary: "/opt/casanovo/bin/casanovo"
    model_ckpt: "/opt/casanovo/models/casanovo_v4_2_0.ckpt"
    config_yaml: "/opt/casanovo/configs/casanovo.yaml"

  pepnet:
    enable: true
    python_bin: "/opt/miniconda/envs/pepnet/bin/python"
    script: "/opt/PepNet/denovo.py"
    model_h5: "/opt/PepNet/model.h5"

  instanovo:
    enable: true
    python_bin: "/opt/miniconda/envs/instanovo/bin/python"
    module_call: "instanovo.transformer.predict"
    model_ckpt: "/opt/InstaNovo/instanovo_extended.ckpt"
    # If InstaNovo needs PYTHONPATH or CUDA vars, define here:
    extra_env:
      PYTHONPATH: "/opt/InstaNovo/InstaNovo"
      CUDA_VISIBLE_DEVICES: "0"

database_build:
  # Reference FASTA ingredients
  human_fasta: "/ref/fasta/UP000005640_9606_processed_tag_0.fasta"
  contaminants_fasta: "/ref/fasta/Contaminants_tag_0.fasta"

  # TE-derived peptide FASTA produced by de novo stage (header=seq)
  # [[EN REQUIRED]] stage_denovo [[EN REQUIRED]] {sample_path}/Denovo/Denovo_TE_SoftMerged_InstaNovo.fasta
  denovo_te_tagged_fasta: "AUTO"

  # === [[EN REQUIRED]]:[[EN REQUIRED]]“tag→TE [[EN REQUIRED]](blast)”[[EN REQUIRED]] TE [[EN REQUIRED]] ===
  # [[EN REQUIRED]] TE [[EN REQUIRED]]/( FASTA;header [[EN REQUIRED]] id [[EN REQUIRED]] blast saccver )
  te_db_fasta: "/ref/fasta/hg38_rmsk_6_frame_singleLine_done.fasta"


  # [[EN REQUIRED]]:[[EN REQUIRED]] method=blast, de novo tag [[EN REQUIRED]] blastp-short [[EN REQUIRED]] TE ,
  # [[EN REQUIRED]] TE [[EN REQUIRED]]“[[EN REQUIRED]] TE [[EN REQUIRED]]”; de novo [[EN REQUIRED]] FASTA [[EN REQUIRED]] TE .
  te_selection:
    method: "blast"         # "blast" | "direct"
    chunks: 15              # [[EN REQUIRED]] FASTA [[EN REQUIRED]]
    threads_per_chunk: 4    # [[EN REQUIRED]]

  # Where to write combined search DB (w/decoys)
  # Path will end up like: {sample_path}/DB_search_iProphet/<ENGINE>/<ENGINE>_DBsearch.fasta
  add_decoy: true  # reverse-sequence decoy

# === [[EN REQUIRED]]:TE [[EN REQUIRED]] blastp-short ( postprocessing )===
blast:
  blastp_bin: "/opt/blastp/blastp"
  blastdbcmd_bin: "/path/to/blastdbcmd"

search_engines:
  comet:
    enable: true
    binary: "/opt/tpp/bin/comet"
    params_file: "/configs/comet_iprophet.params"

  msfragger:
    enable: true
    java_bin: "/usr/bin/java"
    jar: "/opt/MSFragger/MSFragger-4.1.jar"
    base_params: "/configs/closed_fragger.params"

  msgfplus:
    enable: true
    java_bin: "/usr/bin/java"
    jar: "/opt/MS-GF+/MSGFPlus.jar"
    params_file: "/configs/MSGFPlus_Params_iprophet.txt"
    parallel_tasks: 10        # processes for MSGF+

postprocessing:
  # Trans-posable element vs canonical split
  # We tag TE-derived entries with PE=1 and canonical (human proteome) with PE=0
  fdr_threshold: 0.03

  tpp:
    xinteract: "/opt/tpp/bin/xinteract"
    refreshparser: "/opt/tpp/bin/RefreshParser"
    pepxml2csv: "/opt/tpp/bin/pepxml2csv.py"

  philosopher:
    binary: "/opt/philosopher/philosopher"

  # [[EN REQUIRED]]“[[EN REQUIRED]] blastp”( TE [[EN REQUIRED]] blastp )
  blastp:
    enable: true
    binary: "/opt/blastp/blastp"   # blastp-short-capable binary
    threads_per_job: 4
    human_proteome_blastdb: "/ref/blastdb/human_UP000005640"

hla_binding:
  enable: true
  mixmhcpred_bin: "/opt/MixMHCpred/MixMHCpred"
  hla_alleles: "A0201,A6801,B1302,B4001,C0304,C0602"
  peptide_length_min: 8
  peptide_length_max: 14
